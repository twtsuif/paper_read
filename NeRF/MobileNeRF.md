# MobileNeRF

Exploiting the Polygon Rasterization Pipeline for Efficient Neural Field Rendering on Mobile Architectures

利用多边形光栅化管线，在移动端高效渲染NeRF



## 架构图

### 渲染

<img src="https://cdn.jsdelivr.net/gh/twtsuif/picture/twtsuif2023-08-23/cf530d4a1eefe88f84963e08d418790f--324c--image-20230823203300971.png" alt="image-20230823203300971" style="zoom:80%;" />

场景表示为三角形网格，其纹理带有deep features

首先光栅化网格到延迟渲染缓冲区

每个可见片段，执行神经延迟渲染器，将特征和视图方向转换为相应的输出像素颜色



### 训练

<img src="https://cdn.jsdelivr.net/gh/twtsuif/picture/twtsuif2023-08-23/fe2b46ca286d00a714edd059b1778ad1--79fd--image-20230823204101897.png" alt="image-20230823204101897" style="zoom:80%;" />

初始化常规网格，MLP表示网格每个点的特征和不透明度，每条光线计算在网格上的交点，并对点的颜色进行α合成

后续的训练阶段，强制二值不透明度，对特征执行超采样实现反走样





## 摘要

NeRF依赖基于ray marching的专门体渲染算法，与硬件不匹配

基于纹理多边形的新NeRF表示，纹理代表了二元不透明度(binary opacities)和特征向量

传统z-buffer多边形渲染产生的图像，每个像素都带有特征，片段着色器中被小的、视图依赖的MLP所解释，生成最终颜色

大规模像素级并行



## 简介

最近工作将NeRF baking到稀疏3D体素网格，每个体素包含不透明度、漫反射颜色和学习的特征向量

渲染步骤：1.ray marching累积每条光线预先计算的漫反射颜色和特征向量。2. 轻量级MLP对累积特征向量操作，生成视图依赖的残差，添加到累积的漫反射颜色

这种预计算和延迟渲染，渲染速度提高三个数量级

仍然依赖ray marching，无法充分并行，还需要大量显存



MobileNeRF多边形大致遵循场景表面，纹理图集存储不透明度和特征向量

渲染管线不会采样光线或按深度对多边形排序，只能建模二元不透明度



## 相关工作

视图合成，涵盖光场、基于图像渲染、神经渲染。重点关注实时渲染



光场和Lumigraphs存储密集的图像网格，虽然相机自由度有限并且存储巨大，但仍可实时渲染

光流插值中间图像、将光场表示为神经网络、重建场景MPI，可以减少存储空间

多球体图像可以扩大视野，仍然仅支持有限的输出相机运动



其他方法使用显式3D几何实现更多的相机自由度

虽然早期的方法，将视图依赖的纹理应用到3D网格，但后续使用CNN后处理来提高质量，或者输入集合体简化为带有alpha的纹理平面的集合

基于点的表示，在训练后处理网络时，通过联合细化场景几何，进一步提升质量

卷积后处理在每个输出帧独立运行，缺乏3D一致性

我们的方法不需要重建的3D几何作为输入



通过可微逆渲染提取显式三角形网格

...



渲染NeRF涉及在每个像素的多个3D位置评估，妨碍实时渲染

最近工作提高了训练速度

- 对整个光线段的不透明度和颜色建模，而非逐点
- 细分场景，使用较小的神经网络对每个子区域建模
- 解码从3D嵌入获取的特征，这种嵌入可以是密集体素网格、稀疏体素网格、体素网格低阶分解、基于点的表示、多分辨率哈希映射，也可以在没有训练的解码器使用，如直接存储漫反射颜色、将视图依赖的颜色编码为球谐函数

需要大型GPU



对经过训练的NeRF后处理，提高渲染性能

- 通过学习的采样，减少每个像素的网络查询
- 通过评估网络，获得更大的光线段
- 场景细分为更小的网络
- 通过在网格中存储场景不透明度和视图依赖颜色的潜在表示，加速渲染

...





## 方法

 我们希望优化Representation

渲染阶段1：将网格光栅化到屏幕空间，构建特征图像，即创建延迟渲染缓冲区

渲染阶段2：在片段着色器(MLP)运行延迟渲染器将特征转换为彩色图像，输入：特征向量和视图方向，输出：像素颜色



Representation在三个训练阶段构建，从经典的连续表示转向离散表示

训练阶段1：训练具有连续不透明度类NeRF模型，体渲染正交点从多边形网格导出

训练阶段2：二值化不透明度，虽然经典光栅化可以轻松丢弃fragment，但无法优雅处理半透明fragment

训练阶段3：提取稀疏的多边形网格，不透明度和特征bake到纹理图中，存储神经延迟着色器



网格存储为obj文件，纹理贴图存储为png，延迟着色器权重为小json

标准GPU光栅化时，实时渲染器是HTML网页



使用discrete representations来表示连续信号可能走样，基于超采样的反走样解决方案



### 持续训练(训练阶段1)

多边形网格M=(T,V) 三个MLP

网络拓扑T固定，与NeRF类似，自解码方式优化顶点位置V和MLP		![image-20230823204857542](https://cdn.jsdelivr.net/gh/twtsuif/picture/twtsuif2023-08-23/7e3959f07158d2ae8069142b17381940--bc59--image-20230823204857542.png)

预测颜色C，通过沿着射线rt在depth sorted积分点K处进行α合成		![image-20230823205130392](https://cdn.jsdelivr.net/gh/twtsuif/picture/twtsuif2023-08-23/17a53deb448600635dbb2761dc4bf257--eea8--image-20230823205130392.png)

// 并非使用体密度，而是不透明度

不透明度αk和视图依赖的辐射率ck 通过评估位置pk处的MLP得到		![image-20230823205521219](https://cdn.jsdelivr.net/gh/twtsuif/picture/twtsuif2023-08-23/0c85d3b2924b15be93364ae1fadee1c8--36fe--image-20230823205521219.png)



小网络H是延迟神经着色器，给定fragment特征和观察方向，输出每个fragment颜色



#### 多边形网格





## Question

NeRF怎么存成多边形网格的？

纹理的特征怎么使用？
