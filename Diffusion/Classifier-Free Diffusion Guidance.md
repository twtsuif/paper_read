# Classifier-Free Diffusion Guidance



## Abstract

分类器指导是最近引入的一种方法，权衡**训练后**的**条件扩散模型**中的**模式覆盖率**和**样本真实性**，与**其他类型的生成模型**中的**低温采样**或**截断**的精神相同

分类器指导将**扩散模型的分数评估**与**图像分类器的梯度**相结合，因此需要与扩散模型分开训练图像分类器

提出了一个问题：是否可以在没有分类器的情况下进行指导

我们证明了确实可以通过纯生成模型：联合训练一个条件和无条件扩散模型，将所得的条件和无条件的分数估计结合起来，实现样本质量和多样性之间的权衡



## Introduction

扩散模型，可为图像和音频合成任务提供有竞争力的样本质量和似然分数

这些模型提供的音频合成性能可以与自回归模型的质量相竞争，推理步骤要少很多

在FID分数和分类准确度分数方面要比BigGAN-deep和VQVAE好

分类器指导之前，尚不知道如何生成类似截断的BigGAN或低温Glow的，从扩散模型生成低温样本，一些天真的尝试，缩放模型得分向量或减少采样期间添加的高斯噪声，都是无效的

分类器指导将扩散模型的分数估计与分类器对数概率的输入梯度混合

通过改变分类器梯度的强度，Dhariwal和Nichol以一种类似于变化BigGAN的截断参数的方式，权衡IS、FID，或者精度和召回率



分类器指导使扩散模型训练管道变得复杂，需要训练额外的分类器，并且该分类器必须在噪声数据上进行训练，因此通常不可能插入预先训练的分类器

分类器指导在采样期间将分数估计与分类器梯度混合在一起，分类器指导的扩散采样可被解释为试图将图像分类器与基于梯度的对抗攻击混淆



这就提出了一个问题：分类器指导是否能够成功地提升基于分类器的指标，例如 FID 和初始分数 (IS)，仅仅是因为它对此类分类器具有对抗性。朝着分类器梯度的方向前进也与 GAN 训练有一些相似之处，特别是对于非参数生成器；这也提出了一个问题：分类器引导的扩散模型在基于分类器的指标上是否表现良好，因为它们开始类似于 GAN，而众所周知，GAN 在此类指标上表现良好。



为了解决这些问题，我们提出了无分类器指导，我们的指导方法完全避免任何分类器。无分类器指导不是在图像分类器的梯度方向上采样，而是混合条件扩散模型和联合训练的无条件扩散模型的分数估计。通过扫描混合权重，我们实现了类似于分类器引导所实现的 FID/IS 权衡。我们的无分类器指导结果表明，纯生成扩散模型能够与其他类型的生成模型合成极高保真度的样本



## Background

我们在连续时间内训练扩散模型，令x ∼ p(x)且z = {zλ | λ ∈ [λmin, λmax]} 超参数λmin < λmax ∈ R

前向过程q(z|x)是方差保护马尔可夫过程

![image-20230712203119922](https://cdn.jsdelivr.net/gh/twtsuif/picture/twtsuif2023-07-12/ddb3ab531ee51df546001564db4ebc39--2762--image-20230712203119922.png)

